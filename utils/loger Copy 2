function capitalizeFirstWord(text: string): string {
    return text
        .split('_')
        .map((word, index) => (index === 0 ? word.charAt(0).toUpperCase() + word.slice(1) : word))
        .join(' ');
}

// Method decorator to log step execution
function logStep(target: Record<string, unknown>, propertyKey: string, descriptor: PropertyDescriptor) {
    const originalMethod = descriptor.value as (...args: unknown[]) => Promise<unknown>;

    descriptor.value = async function (...args: unknown[]) {
        const stepName = capitalizeFirstWord(propertyKey);
        const timestamp = new Date().toLocaleTimeString('en-US', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });

        console.log(`[${timestamp}] Step: ${stepName}`);
        return await originalMethod.apply(this, args);
    };

    return descriptor;
}

// Class decorator to apply logStep to all public methods
// eslint-disable-next-line @typescript-eslint/no-explicit-any
function logAllMethods<T extends { new(...args: any[]): {} }>(constructor: T): T {
    const prototype = constructor.prototype;

    Object.getOwnPropertyNames(prototype).forEach((methodName) => {
        // Skip constructor and private methods
        if (methodName !== 'constructor' && !methodName.startsWith('_')) {
            const descriptor = Object.getOwnPropertyDescriptor(prototype, methodName);

            if (descriptor && typeof descriptor.value === 'function') {
                logStep(prototype, methodName, descriptor);
                Object.defineProperty(prototype, methodName, descriptor);
            }
        }
    });

    return constructor;
}

// Simple logger to log messages with optional Allure step integration
class SimpleLogger {
    info(message: string): void {
        console.log(`[INFO] ${message}`);
    }

    step(message: string): void {
        console.log(`[STEP] ${message}`);
    }

    debug(message: string): void {
        console.debug(`[DEBUG] ${message}`);
    }

    warn(message: string): void {
        console.warn(`[WARN] ${message}`);
    }

    error(message: string): void {
        console.error(`[ERROR] ${message}`);
    }
}

const logger = new SimpleLogger();

export { logStep, logAllMethods, capitalizeFirstWord, logger, SimpleLogger };
